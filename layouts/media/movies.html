{{ define "main" }}
<div class="media-page">
    <div class="index-content">
        {{ with .Content }}{{ . }}{{ end }}
    </div>

    {{ $data := $.Site.Data.movies }}
    {{ if $data }}
    <div class="page-stats">
        <span class="stat-item">{{ $data.totalCount }} movies</span>
        <span class="stat-item">
            <a href="https://trakt.tv/users/{{ $data.username }}/lists" target="_blank" rel="noopener">Trakt ↗</a>
        </span>
    </div>

    {{ range $data.categories }}
    <section class="media-section">
        <h2 class="section-title">{{ .displayName }} <span class="section-count">({{ .count }})</span></h2>
        <div class="media-grid">
            {{ range .entries }}
            <a href="{{ .url }}" target="_blank" rel="noopener" class="media-card" title="{{ .title }}">
                <div class="media-cover">
                    {{ if .posterImage }}<img src="{{ .posterImage }}" alt="{{ .title }}" loading="lazy" />
                    {{ else }}<div class="media-placeholder">{{ .title | truncate 20 }}</div>{{ end }}
                    {{ if gt .rating 0.0 }}<span class="media-score">★ {{ printf "%.1f" .rating }}</span>{{ end }}
                </div>
                <div class="media-info">
                    <h3 class="media-title">{{ .title }}</h3>
                    {{ with .year }}<div class="media-progress">{{ . }}</div>{{ end }}
                </div>
            </a>
            {{ end }}
        </div>
    </section>
    {{ end }}
    {{ else }}
    <div class="no-data">
        <p>No movies data yet. Set TRAKT_CLIENT_ID to fetch data.</p>
    </div>
    {{ end }}
</div>
{{ end }}